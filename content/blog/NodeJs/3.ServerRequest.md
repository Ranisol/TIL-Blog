---
title: 서버에 요청하기(AJAX)
date: "2020-09-19"
description: 
---

# 1. 요청과 응답
- 서버에 요청: 일반적으로 http(url)로 요청하게 됨.
- 서버가 응답: 다양한 형태로 받을 수 있음(JSON, HTML, plain text등)

# 2. AJAX(Async Js  And Xml)
- 자바스크립트를 이용한 서버와의 통신
- 페이지의 일부만을 위한 데이터를 로드한다.
  - 페이지 전체를 로드하지 않고, 필요한 일부 데이터만을 불러오는 것을 비동기(async) 방식이라고 한다.
- 이 과정에서 브라우저가 가지고 있는 XMLHttpRequest객체를 이용함. 이 객체를 통해 클라이언트와 서버간에 XML데이터를 주고받는다.
- 이러한 AJAX를 구현하기 위해 javascript에서는 내장 라이브러리인 fetch api 또는 axios를 사용할 수 있다.

## 2.1 fetch 방식
()
```js
fetch('http://서버주소/weather?q=Seoul')  // 요청: url로 요청함.
.then(function(resp) {
  return resp.json(); // 응답: 응답 형식에 따라 resp.text() 가 될 수도 있다
})
.then(function(json) {
  console.log(json); // { tempature: 27 }
});
```

## 2.2. axios 방식

### (1) 서버로 요청을 보내기
- HTML아래 스크립트를 추가해 사용 가능.

- axios.get함수의 인수로 요청을 보낼 주소를 넣음

```js
axios.get('http...')
  .then(result) => {
    ...
  }
  .catch(error) => {
    ...
  }
```

### (2) async, await을 이용하기?
- 이건 promise를 지원하는지 안하는지 확인해야함. 이건 알아보고 사용해야함
- axios.get은 지원하는데, 아래와 같이 사용할 수 있음.

```js
async () => {
  try{
    const result = await axios.get('http...')
  }
}catch(error){
  ...
}
```
## 3.3 axios.get vs axios.post
- post는 데이터를 담아 서버로 보내는게 가능하다. 데이터를 담아 서버로 보낼 때에는, post의 두번째 인자로 보낼 데이터를 넣어주면 된다.

```js
let data = {name:'hlel'}
axios.post('http...', data)
```

# 3. 서버 요청시, 다양한 이슈 처리하기


## 3.1 API 예제
- 날씨 api:  https://openweathermap.org/API
- 다양한 api https://www.apistore.co.kr


## 3.2 FormData(데이터 전달)
- HTML의 form태그에 담긴 데이터를 ajax요청으로 보내고 싶은 경우가 있음.
이 때, formData객체를 이용하는게 가능. 
- formData에는 다음과 같은 메서드가 있음
  - append: 데이터를 하나씩 추가
  - has로 데이터 존재 여부 확인, get으로 조회, getAll로 모두 조회
  - set으로 데이터 수정
  - delete로 데이터 삭제

```js
const formData = new FormData()
formData.appned('a','b');
```

## 3.3 주소창에 한글 보내고 가져오는 경우
- 서버가 처리를 하지 못하는 경우가 종종 발생한다.
- 이럴때, encodeURLComponent, decodeURLComponent로 한글을 감싸, 처리할 수 있다.

```js
const result = await axios.get(`http.../${encodeURLComponent('노드')}`)
```

- 또한, 이렇게 보낸 인코딩 된 url를 다시 받아올때는 decodeURLComponent로 감싸서 가져옴.

## 3.4 HTML태그에 데이터를 저장
이거는 Twittler하면서 사용해봤던 것 같은데, HTML태그에 데이터를 저장하는 방식이다. 
- 'data-속성명'을 통해 태그 내 저장이 가능하다. 
- 그리고 여기에 접근하려면, dataset이라는 속성명을 통해 접근 가능하다.
- 반대로 자바스크립트 dataset에 값을 넣게 되면, data-속성이 생긴다.
- 이러한 방식의 단점은?
  - html태그에 보여지기 때문에, 누구나 접근이 가능하다는 점.

```js
<li data-id='1' data-user-job="programmer">a</li>
```
