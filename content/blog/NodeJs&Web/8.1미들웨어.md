---
title: ExpressJS MiddleWare
date: "2020-10-02"
description: 
---
# 1. 미들웨어 사용하기

## (1) 미들웨어 불러와서 사용

```js
const cors = require('cors')
app.use(cors())
```

## (2) 미들웨어 여러개 사용
```js
app.use('/', middle1, middle2, middle3)
```

## (3) 미들웨어 정의하기

```js
const middleWare = (req, res, next) => {
    console.log(`시작을 알리는 미들웨어:${req.protocol}://${req.get('host')}${req.originalUrl}에서 실행`)
    next()
}
app.use(middleWare)
```
위의 middleWare를 다른 파일에서 정의하고, require('middleWare')를 통해 불러와서 사용할 수 있음.

## (4) 오류를 처리하는 미들웨어
```js
const middleWare = (err, req, res, next) => {
    if(err){
        return err
    }else{
        next()
    }
}
```

# 2. Express Method(Built-in MiddleWare)


## (1) express.json(): Body받기
[Stackoverflow - 'Sending data'가 있는 POST와 PUT 요청시, express.json()와 express.urlencoded()의 필요성과 역할](https://stackoverflow.com/questions/23259168/what-are-express-json-and-express-urlencoded/51844327)

다음과 같이 사용한다.
```js
app.use(express.json())
```

사용함으로써, request의 body에 접근해 값을 가져올 수 있게된다.
```js
router.put(path ,(req, res) => {
    // ...
    req.body
})
```

그리고 urlencoded와 더불어 third-party인 body-parser로 대체될 수 있다.

## (2) express.urlencoded()
일반적으로 다음과 같이 사용한다.
```js
app.use(express.urlencoded({extended: false}))
```

만일 extended: false라면, 중첩 객체(Nested object)는 무시한다.
즉, `{person:{name:'cs'}}`와 같은 값은 무시한다는 것이다. 

반면, extended: true라면, 중첩 객체 여부가 상관이 없게 된다.





---
## (3) express.Router(): 라우터 분리
라우터가 없으면, 하나의 파일에 모든 라우터를 담아야 한다. Express를 사용하면서, 라우터를 만들기 위해 점철된 if else문으로부터는 벗어났지만, 여전히 하나의 파일에 모든 라우터를 담아야 한다는 사실은 변하지 않는다. 그럴 때, 라우터를 유지보수하기 쉽도록 파일별로 구별할 수 있도록 만든 것이 라우터.



### 1) 라우터는 다음과 같이 정의한다.
```js
// 일반적으로 app.js와는 다른 파일에 별도로 존재한다.  
const router = expess.Router()
// ... router에 붙이는 코드들 ...
module.exports = router;
```

### 2) 사용방법은 app과 마찬가지이다. 
use, get, post등 모두 붙일 수 있다.


### 3) next('route')
이를 만나면, 나머지 미들웨어를 건너뛴다.

대신, 주소와 일치하는 다음 라우터로 넘어간다.

```js
router.get('/', (req,res,next) => {
    next('route');
},(req,res,next) => {
    console.log('설치 되지 않았습니다.');
},(req,res,next) => {
    next();
});
router.get('/',function(req,res){
    console.log('실행');
    res.render('index',{title:'Express'});
})
```

---
## (4) express.static(): 정적 파일 제공
express.static(root, [options])
[Expressjs공식문서-Serving static files in Express](http://expressjs.com/en/starter/static-files.html)


정적파일이란?
- 이미지, CSS파일, 자바스크립트 파일 등.

어떻게 사용?
```js
app.use(express.static('directory'))
// 아래와 같이 적용
// http://localhost:3000/images/kitten.jpg
// http://localhost:3000/css/style.css
// http://localhost:3000/js/app.js
// http://localhost:3000/images/bg.png
// http://localhost:3000/hello.html
```
하지만 위와 같은 상대경로는 실제로 실행하는 곳을 기준으로 판단한다. 따라서 Express app을 다른 디렉토리에서 실행하려면, 다음과 같은 방식이 더 안전하다.
```js
app.use(express.static(path.join(__dirname, 'directory')))
```

만일 특정한 path에 정적 파일들을 올리고 싶다면?
```js
app.use('/newpath', express.static('public'))
// http://localhost:3000/newpath/images/kitten.jpg
// http://localhost:3000/newpath/css/style.css
// http://localhost:3000/newpath/js/app.js
// http://localhost:3000/newpath/images/bg.png
// http://localhost:3000/newpath/hello.html
```

추가로 [옵션](http://expressjs.com/en/4x/api.html#express.static)에 대한 사항




# 3. Third Party MiddleWare

## (1) body-parser

## (2) cors

## (3) cookie-parser
